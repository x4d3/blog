<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Tests - La M's Valentine Adventure</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #0f0;
        }
        h1 {
            color: #ff69b4;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #2a2a2a;
            border: 2px solid #0f0;
            border-radius: 5px;
        }
        .test {
            margin: 10px 0;
            padding: 10px;
            background: #1a1a1a;
            border-left: 4px solid #666;
        }
        .test.pass {
            border-left-color: #0f0;
        }
        .test.fail {
            border-left-color: #f00;
            color: #f00;
        }
        .test-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .test-result {
            margin-left: 20px;
            font-size: 14px;
        }
        button {
            background: #ff69b4;
            color: #000;
            border: 3px solid #000;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            margin: 10px 5px;
        }
        button:hover {
            background: #ff1493;
        }
        #summary {
            font-size: 20px;
            padding: 20px;
            background: #000;
            border: 3px solid #0f0;
            margin-bottom: 20px;
        }
        .controls-demo {
            margin: 20px 0;
            padding: 20px;
            background: #87ceeb;
            border-radius: 10px;
            position: relative;
            height: 200px;
        }
        iframe {
            width: 100%;
            height: 400px;
            border: 3px solid #0f0;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>ðŸŽ® La M's Valentine Adventure - Test Suite</h1>

    <div id="summary">
        <div id="test-count">Running tests...</div>
    </div>

    <button onclick="runAllTests()">Run All Tests</button>
    <button onclick="location.href='index.html'">Play Game</button>

    <div class="test-section">
        <h2>ðŸ“Š Test Results</h2>
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <h2>ðŸŽ® Visual Tests</h2>
        <div class="controls-demo" id="controls-demo">
            <p style="color: #000; font-weight: bold;">Mobile Controls Preview (should be visible):</p>
        </div>
    </div>

    <div class="test-section">
        <h2>ðŸŽ¯ Game Preview</h2>
        <iframe src="index.html" title="Game Preview"></iframe>
    </div>

    <script>
        const tests = [];
        let passCount = 0;
        let failCount = 0;

        function test(name, fn) {
            tests.push({ name, fn });
        }

        function assert(condition, message) {
            if (!condition) {
                throw new Error(message);
            }
        }

        function assertEquals(actual, expected, message) {
            if (actual !== expected) {
                throw new Error(`${message}: expected ${expected}, got ${actual}`);
            }
        }

        function assertGreaterThan(actual, value, message) {
            if (actual <= value) {
                throw new Error(`${message}: expected > ${value}, got ${actual}`);
            }
        }

        function assertLessThan(actual, value, message) {
            if (actual >= value) {
                throw new Error(`${message}: expected < ${value}, got ${actual}`);
            }
        }

        // Physics Tests
        test('Gravity should be reasonable (not too fast)', () => {
            const gravity = 0.5;
            assertLessThan(gravity, 1.0, 'Gravity should be less than 1.0 for gentle falling');
            assertGreaterThan(gravity, 0.3, 'Gravity should be greater than 0.3 to feel responsive');
        });

        test('Player should have proper dimensions', () => {
            const player = { width: 48, height: 64 };
            assertEquals(player.width, 48, 'Player width should be 48');
            assertEquals(player.height, 64, 'Player height should be 64');
        });

        test('Player jump power should be balanced', () => {
            const jumpPower = 13;
            assertGreaterThan(jumpPower, 10, 'Jump power should be sufficient');
            assertLessThan(jumpPower, 20, 'Jump power should not be too high');
        });

        test('Player speed should be reasonable', () => {
            const maxSpeed = 5.5;
            assertGreaterThan(maxSpeed, 3, 'Speed should allow decent movement');
            assertLessThan(maxSpeed, 10, 'Speed should not be too fast');
        });

        // Collision Detection Test
        test('Collision detection should work correctly', () => {
            function checkCollision(rect1, rect2) {
                return rect1.x < rect2.x + rect2.width &&
                       rect1.x + rect1.width > rect2.x &&
                       rect1.y < rect2.y + rect2.height &&
                       rect1.y + rect1.height > rect2.y;
            }

            const player = { x: 0, y: 0, width: 48, height: 64 };
            const platform = { x: 0, y: 50, width: 100, height: 20 };

            assert(checkCollision(player, platform), 'Should detect collision when overlapping');

            player.x = 200;
            assert(!checkCollision(player, platform), 'Should not detect collision when not overlapping');
        });

        // Level Design Tests
        test('Should have ground platform', () => {
            // Simulated ground check
            const groundExists = true; // Would check platforms array
            assert(groundExists, 'Ground platform should exist');
        });

        test('Should have collectibles', () => {
            const collectibleCount = 5;
            assertGreaterThan(collectibleCount, 0, 'Should have collectibles');
            assertEquals(collectibleCount, 5, 'Should have exactly 5 TARDIS boxes');
        });

        test('Should have pipes for obstacles', () => {
            const pipeCount = 6;
            assertGreaterThan(pipeCount, 0, 'Should have pipes');
        });

        // Character Tests
        test('La M should have correct attributes', () => {
            const laM = {
                hasGlasses: true,
                hasPinkJumper: true,
                hasBrownHair: true,
                hasOboe: true
            };
            assert(laM.hasGlasses, 'La M should have glasses');
            assert(laM.hasPinkJumper, 'La M should have pink jumper');
            assert(laM.hasBrownHair, 'La M should have brown hair');
            assert(laM.hasOboe, 'La M should have oboe');
        });

        test('Le X should have correct attributes', () => {
            const leX = {
                hasBrownHair: true,
                hasFrenchHorn: true,
                hasBlueShirt: true
            };
            assert(leX.hasBrownHair, 'Le X should have brown hair');
            assert(leX.hasFrenchHorn, 'Le X should have French horn');
            assert(leX.hasBlueShirt, 'Le X should have blue shirt');
        });

        // Mobile Controls Tests
        test('D-pad buttons should be visible (dark background)', () => {
            const buttonOpacity = 0.95;
            assertGreaterThan(buttonOpacity, 0.8, 'Buttons should be mostly opaque for visibility');
        });

        test('Touch controls should have proper z-index', () => {
            const controlsZIndex = 10;
            assertGreaterThan(controlsZIndex, 5, 'Controls should be above game canvas');
        });

        test('Jump button should be large enough for mobile', () => {
            const jumpButtonSize = 110;
            assertGreaterThan(jumpButtonSize, 80, 'Jump button should be at least 80px');
        });

        // Canvas Tests
        test('Canvas should resize without infinite loop', () => {
            // This would be tested by checking if resize triggers properly
            const hasProperResizeLogic = true;
            assert(hasProperResizeLogic, 'Canvas resize should not cause infinite loop');
        });

        // Valentine Scene Tests
        test('Valentine scene should exist', () => {
            const hasValentineScene = true;
            assert(hasValentineScene, 'Should have Valentine scene at end');
        });

        test('NO button should run away on click', () => {
            const noButtonEscapes = true;
            assert(noButtonEscapes, 'NO button should escape when clicked');
        });

        test('YES button should grow when NO is clicked', () => {
            const yesButtonGrows = true;
            assert(yesButtonGrows, 'YES button should grow when NO is clicked');
        });

        // Run all tests
        function runAllTests() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '';
            passCount = 0;
            failCount = 0;

            tests.forEach(({ name, fn }) => {
                const testDiv = document.createElement('div');
                testDiv.className = 'test';

                const nameDiv = document.createElement('div');
                nameDiv.className = 'test-name';
                nameDiv.textContent = name;

                const resultDiv = document.createElement('div');
                resultDiv.className = 'test-result';

                try {
                    fn();
                    testDiv.classList.add('pass');
                    resultDiv.textContent = 'âœ“ PASS';
                    passCount++;
                } catch (error) {
                    testDiv.classList.add('fail');
                    resultDiv.textContent = 'âœ— FAIL: ' + error.message;
                    failCount++;
                }

                testDiv.appendChild(nameDiv);
                testDiv.appendChild(resultDiv);
                resultsDiv.appendChild(testDiv);
            });

            updateSummary();
        }

        function updateSummary() {
            const total = passCount + failCount;
            const percentage = total > 0 ? Math.round((passCount / total) * 100) : 0;

            document.getElementById('test-count').innerHTML = `
                <strong>Total Tests:</strong> ${total}<br>
                <strong style="color: #0f0;">Passed:</strong> ${passCount}<br>
                <strong style="color: #f00;">Failed:</strong> ${failCount}<br>
                <strong>Success Rate:</strong> ${percentage}%
            `;
        }

        // Add visual control demo
        function createControlsDemo() {
            const demo = document.getElementById('controls-demo');

            const dpad = document.createElement('div');
            dpad.style.cssText = `
                position: absolute;
                left: 30px;
                bottom: 30px;
                width: 180px;
                height: 180px;
            `;

            const buttons = [
                { id: 'up', text: 'â–²', top: 0, left: 60 },
                { id: 'left', text: 'â—„', top: 60, left: 0 },
                { id: 'right', text: 'â–º', top: 60, right: 0 },
                { id: 'down', text: 'â–¼', bottom: 0, left: 60 }
            ];

            buttons.forEach(btn => {
                const button = document.createElement('div');
                button.style.cssText = `
                    position: absolute;
                    width: 60px;
                    height: 60px;
                    background: rgba(80, 80, 80, 0.95);
                    border: 5px solid #fff;
                    border-radius: 8px;
                    color: #fff;
                    font-size: 26px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    ${btn.top !== undefined ? 'top: ' + btn.top + 'px;' : ''}
                    ${btn.bottom !== undefined ? 'bottom: ' + btn.bottom + 'px;' : ''}
                    ${btn.left !== undefined ? 'left: ' + btn.left + 'px;' : ''}
                    ${btn.right !== undefined ? 'right: ' + btn.right + 'px;' : ''}
                `;
                button.textContent = btn.text;
                dpad.appendChild(button);
            });

            const center = document.createElement('div');
            center.style.cssText = `
                position: absolute;
                top: 60px;
                left: 60px;
                width: 60px;
                height: 60px;
                background: rgba(40, 40, 40, 0.8);
                border: 4px solid rgba(255, 255, 255, 0.6);
                border-radius: 4px;
            `;
            dpad.appendChild(center);

            const jumpBtn = document.createElement('div');
            jumpBtn.style.cssText = `
                position: absolute;
                right: 40px;
                bottom: 60px;
                width: 110px;
                height: 110px;
                background: rgba(255, 50, 50, 0.85);
                border: 5px solid #fff;
                color: #fff;
                font-size: 20px;
                font-weight: bold;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            jumpBtn.textContent = 'JUMP';

            demo.appendChild(dpad);
            demo.appendChild(jumpBtn);
        }

        // Auto-run tests on load
        window.onload = () => {
            runAllTests();
            createControlsDemo();
        };
    </script>
</body>
</html>
