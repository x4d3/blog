---
emoji: ðŸ§¦
layout: post
title: Assign Parts
category: Random
description: Description
---
<style>
    body {
        font-family: Arial, sans-serif;
        padding: 20px;
    }

    .participant {
        margin-bottom: 10px;
    }

    .sortable-list {
        list-style: none;
        padding: 0;
        margin: 0;
        border: 1px solid #ccc;
        min-height: 100px;
        width: 300px;
    }

    .sortable-list li {
        padding: 5px 10px;
        border-bottom: 1px solid #eee;
        cursor: move;
    }

    .sortable-list li:last-child {
        border-bottom: none;
    }

    .output {
        margin-top: 20px;
    }

    table {
        border-collapse: collapse;
        width: 100%;
        margin-top: 10px;
    }

    th, td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: left;
    }

    th {
        /*background-color: #f2f2f2;*/
    }

    button {
        margin: 5px;
    }
</style>
<h1>Musical Part Assignment</h1>

<h3>Items</h3>
<textarea id="itemList" oninput="updateItemLists()" placeholder="One item per line" rows=15>Item 1
Item 2
Item 3
Item 4
Item 5
Item 6</textarea>

<div id="participants"></div>
<button onclick="addParticipant()">Add Participant</button>
<button onclick="assignParts()">Assign Parts</button>

<div class="output">
    <h2>Assignments</h2>
    <div id="result"></div>
    <pre id="logs"></pre>
</div>

<script>
    let participantCount = 0;

    function addParticipant(name = '') {
        const container = document.createElement('div');
        container.className = 'participant';

        const itemList = document.getElementById('itemList').value.trim().split('\n').map(x => x.trim()).filter(x => x);

        const listHtml = itemList.map(item => `<li draggable="true">${item}</li>`).join('');

        container.innerHTML = `
        <input type="text" placeholder="Name" value="${name}"><br>
        <ul class="sortable-list" ondragstart="onDragStart(event)" ondragover="onDragOver(event)" ondrop="onDrop(event)">${listHtml}</ul>
        <button onclick="removeParticipant(this)">Remove</button>
        `;
        document.getElementById('participants').appendChild(container);
    }

    function removeParticipant(button) {
        button.parentElement.remove();
    }

    function updateItemLists() {
        const itemList = document.getElementById('itemList').value.trim().split('\n').map(x => x.trim()).filter(x => x);
        document.querySelectorAll('.participant').forEach(p => {
            const ul = p.querySelector('ul');
            ul.innerHTML = itemList.map(item => `<li draggable="true">${item}</li>`).join('');
        });
    }

    let dragged;
    function onDragStart(event) {
        dragged = event.target;
        event.dataTransfer.effectAllowed = 'move';
    }

    function onDragOver(event) {
        event.preventDefault();
        event.dataTransfer.dropEffect = 'move';
    }

    function onDrop(event) {
        event.preventDefault();
        if (event.target.tagName === 'LI' && event.target !== dragged) {
            const list = event.target.parentNode;
            const nodes = Array.from(list.children);
            const indexDragged = nodes.indexOf(dragged);
            const indexTarget = nodes.indexOf(event.target);
            if (indexDragged < indexTarget) {
                list.insertBefore(dragged, event.target.nextSibling);
            } else {
                list.insertBefore(dragged, event.target);
            }
        }
    }

    function assignParts() {
        const participants = document.querySelectorAll('.participant');
        const names = [];
        const preferences = {};
        const itemSet = new Set();

        participants.forEach(p => {
            const name = p.querySelector('input').value.trim();
            const prefs = Array.from(p.querySelectorAll('ul li')).map(li => li.textContent.trim());
            if (name && prefs.length) {
                names.push(name);
                preferences[name] = prefs;
                prefs.forEach(item => itemSet.add(item));
            }
        });

        const items = Array.from(itemSet).sort();
        const n = names.length;
        const m = items.length;
        const roles = Array.from({ length: m }, () => Array(n).fill(null));

        let order = [...Array(n).keys()];
        const logs = []

        let assignmentsNeeded = m * n;
        while (assignmentsNeeded > 0) {
            for (let round = 0; round < 2; round++) {
                if (round % 2 !== 0) order.reverse();

                for (let pi of order) {
                    const person = names[pi];
                    const prefList = preferences[person];
                    let assigned = false;
                    for (let role = 0; role < n; role++) {
                        for (let item of prefList) {
                            const i = items.indexOf(item);
                            if (i === -1) {
                                throw `Could not find item ${item } in items${items}`
                            }
                            if (roles[i].slice(0, role).some(r => r === person)){
                                continue
                            }
                            if (!roles[i][role]) {
                                logs.push(`${person} pick ${item} for Part ${role + 1}`)
                                roles[i][role] = person;
                                assignmentsNeeded--;
                                assigned = true;
                                break;
                            }
                        }
                        if (assigned) break;
                    }
                }
            }
        }

        let html = '<table><tr><th>Item</th>' + [...Array(n).keys()].map(i => `<th>Part ${i + 1}</th>`).join('') + '</tr>';
        for (let i = 0; i < items.length; i++) {
            html += `<tr><td>${items[i]}</td>` + roles[i].map(p => `<td>${p || ''}</td>`).join('') + '</tr>';
        }
        html += '</table>';

        document.getElementById('result').innerHTML = html;
        document.getElementById('logs').innerHTML = logs.join("\n");

    }

    addParticipant('Alex');
    addParticipant('Jean');
    addParticipant('Bruno');
    updateItemLists();
</script>
